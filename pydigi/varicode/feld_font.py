"""
Hellschreiber Font Definitions

This module contains bitmap font data for Hellschreiber modes.
Each character is represented as a 14-row bitmap where each row
is a 16-bit value representing the column data.

The font data is adapted from fldigi's Feld7x7-14 font.

Format:
- Each character is a tuple of 14 integers (one per row)
- Each integer represents the bitmap for that row (16 bits max)
- Characters are transmitted column-by-column (vertical slices)
- Bit 15 is leftmost, bit 0 is rightmost
- Row 0 is top, row 13 is bottom

Reference: fldigi/src/feld/Feld7x7-14.cxx
"""

# Feld7x7-14 font - 14 rows per character
# Format: character -> tuple of 14 row values
FELD_7X7_14 = {
    ' ': (0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000),
    '!': (0x0000, 0x0000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x0000, 0x0000, 0x8000, 0x8000, 0x0000, 0x0000),
    '"': (0x0000, 0x0000, 0xA000, 0xA000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000),
    '#': (0x0000, 0x0000, 0x5000, 0x5000, 0xF800, 0xF800, 0x5000, 0x5000, 0xF800, 0xF800, 0x5000, 0x5000, 0x0000, 0x0000),
    '$': (0x0000, 0x2000, 0x7800, 0x7800, 0xA000, 0xA000, 0x7000, 0x7000, 0x2800, 0x2800, 0xF000, 0xF000, 0x2000, 0x0000),
    '%': (0x0000, 0x0000, 0xC800, 0xC800, 0x1000, 0x1000, 0x2000, 0x2000, 0x4000, 0x4000, 0x9800, 0x9800, 0x0000, 0x0000),
    '&': (0x0000, 0x0000, 0x4000, 0x4000, 0xE000, 0xE000, 0x6800, 0x6800, 0x9000, 0x9000, 0x7800, 0x7800, 0x0000, 0x0000),
    "'": (0x0000, 0x0000, 0xC000, 0xC000, 0x4000, 0x4000, 0x8000, 0x8000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000),
    '(': (0x0000, 0x0000, 0x6000, 0x6000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x6000, 0x6000, 0x0000, 0x0000),
    ')': (0x0000, 0x0000, 0xC000, 0xC000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0xC000, 0xC000, 0x0000, 0x0000),
    '*': (0x0000, 0x0000, 0xA800, 0xA800, 0x7000, 0x7000, 0xF800, 0xF800, 0x7000, 0x7000, 0xA800, 0xA800, 0x0000, 0x0000),
    '+': (0x0000, 0x0000, 0x0000, 0x0000, 0x2000, 0x2000, 0xF800, 0xF800, 0x2000, 0x2000, 0x0000, 0x0000, 0x0000, 0x0000),
    ',': (0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC000, 0xC000, 0x4000, 0x4000, 0x8000, 0x8000, 0x0000),
    '-': (0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xF800, 0xF800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000),
    '.': (0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC000, 0xC000, 0xC000, 0x0000, 0x0000),
    '/': (0x0000, 0x0000, 0x0800, 0x0800, 0x1000, 0x1000, 0x2000, 0x2000, 0x4000, 0x4000, 0x8000, 0x8000, 0x0000, 0x0000),
    '0': (0x0000, 0x0000, 0x7000, 0x7000, 0x9800, 0x9800, 0xA800, 0xA800, 0xC800, 0xC800, 0x7000, 0x7000, 0x0000, 0x0000),
    '1': (0x0000, 0x0000, 0x6000, 0x6000, 0xA000, 0xA000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x0000, 0x0000),
    '2': (0x0000, 0x0000, 0xE000, 0xE000, 0x1000, 0x1000, 0x2000, 0x2000, 0x4000, 0x4000, 0xF800, 0xF800, 0x0000, 0x0000),
    '3': (0x0000, 0x0000, 0xF000, 0xF000, 0x0800, 0x0800, 0x3000, 0x3000, 0x0800, 0x0800, 0xF000, 0xF000, 0x0000, 0x0000),
    '4': (0x0000, 0x0000, 0x9000, 0x9000, 0x9000, 0x9000, 0xF800, 0xF800, 0x1000, 0x1000, 0x1000, 0x1000, 0x0000, 0x0000),
    '5': (0x0000, 0x0000, 0xF800, 0xF800, 0x8000, 0x8000, 0xF000, 0xF000, 0x0800, 0x0800, 0xF000, 0xF000, 0x0000, 0x0000),
    '6': (0x0000, 0x0000, 0x7000, 0x7000, 0x8000, 0x8000, 0xF000, 0xF000, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    '7': (0x0000, 0x0000, 0xF800, 0xF800, 0x0800, 0x0800, 0x1000, 0x1000, 0x2000, 0x2000, 0x4000, 0x4000, 0x0000, 0x0000),
    '8': (0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0x7000, 0x7000, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    '9': (0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0x7800, 0x7800, 0x0800, 0x0800, 0x7000, 0x7000, 0x0000, 0x0000),
    ':': (0x0000, 0x0000, 0x0000, 0x0000, 0xC000, 0xC000, 0x0000, 0x0000, 0xC000, 0xC000, 0x0000, 0x0000, 0x0000, 0x0000),
    ';': (0x0000, 0x0000, 0x0000, 0xC000, 0xC000, 0x0000, 0x0000, 0xC000, 0xC000, 0x4000, 0x4000, 0x8000, 0x8000, 0x0000),
    '<': (0x0000, 0x0000, 0x0800, 0x0800, 0x3000, 0x3000, 0xC000, 0xC000, 0x3000, 0x3000, 0x0800, 0x0800, 0x0000, 0x0000),
    '=': (0x0000, 0x0000, 0x0000, 0x0000, 0xF800, 0xF800, 0x0000, 0x0000, 0xF800, 0xF800, 0x0000, 0x0000, 0x0000, 0x0000),
    '>': (0x0000, 0x0000, 0x8000, 0x8000, 0x6000, 0x6000, 0x1800, 0x1800, 0x6000, 0x6000, 0x8000, 0x8000, 0x0000, 0x0000),
    '?': (0x0000, 0x0000, 0xE000, 0xE000, 0x1000, 0x1000, 0x2000, 0x2000, 0x0000, 0x0000, 0x2000, 0x2000, 0x0000, 0x0000),
    '@': (0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0xB000, 0xB000, 0x8000, 0x8000, 0x7800, 0x7800, 0x0000, 0x0000),
    'A': (0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0xF800, 0xF800, 0x8800, 0x8800, 0x8800, 0x8800, 0x0000, 0x0000),
    'B': (0x0000, 0x0000, 0xF000, 0xF000, 0x4800, 0x4800, 0x7000, 0x7000, 0x4800, 0x4800, 0xF000, 0xF000, 0x0000, 0x0000),
    'C': (0x0000, 0x0000, 0x7800, 0x7800, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x7800, 0x7800, 0x0000, 0x0000),
    'D': (0x0000, 0x0000, 0xF000, 0xF000, 0x4800, 0x4800, 0x4800, 0x4800, 0x4800, 0x4800, 0xF000, 0xF000, 0x0000, 0x0000),
    'E': (0x0000, 0x0000, 0xF800, 0xF800, 0x8000, 0x8000, 0xE000, 0xE000, 0x8000, 0x8000, 0xF800, 0xF800, 0x0000, 0x0000),
    'F': (0x0000, 0x0000, 0xF800, 0xF800, 0x8000, 0x8000, 0xE000, 0xE000, 0x8000, 0x8000, 0x8000, 0x8000, 0x0000, 0x0000),
    'G': (0x0000, 0x0000, 0x7800, 0x7800, 0x8000, 0x8000, 0x9800, 0x9800, 0x8800, 0x8800, 0x7800, 0x7800, 0x0000, 0x0000),
    'H': (0x0000, 0x0000, 0x8800, 0x8800, 0x8800, 0x8800, 0xF800, 0xF800, 0x8800, 0x8800, 0x8800, 0x8800, 0x0000, 0x0000),
    'I': (0x0000, 0x0000, 0xE000, 0xE000, 0x4000, 0x4000, 0x4000, 0x4000, 0x4000, 0x4000, 0xE000, 0xE000, 0x0000, 0x0000),
    'J': (0x0000, 0x0000, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x0800, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    'K': (0x0000, 0x0000, 0x8800, 0x8800, 0x9000, 0x9000, 0xE000, 0xE000, 0x9000, 0x9000, 0x8800, 0x8800, 0x0000, 0x0000),
    'L': (0x0000, 0x0000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0xF800, 0xF800, 0x0000, 0x0000),
    'M': (0x0000, 0x0000, 0x8800, 0x8800, 0xD800, 0xD800, 0xA800, 0xA800, 0x8800, 0x8800, 0x8800, 0x8800, 0x0000, 0x0000),
    'N': (0x0000, 0x0000, 0x8800, 0x8800, 0xC800, 0xC800, 0xA800, 0xA800, 0x9800, 0x9800, 0x8800, 0x8800, 0x0000, 0x0000),
    'O': (0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    'P': (0x0000, 0x0000, 0xF000, 0xF000, 0x8800, 0x8800, 0xF000, 0xF000, 0x8000, 0x8000, 0x8000, 0x8000, 0x0000, 0x0000),
    'Q': (0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0x8800, 0x8800, 0xA800, 0xA800, 0x7000, 0x7000, 0x1000, 0x1000),
    'R': (0x0000, 0x0000, 0xF000, 0xF000, 0x8800, 0x8800, 0xF000, 0xF000, 0x9000, 0x9000, 0x8800, 0x8800, 0x0000, 0x0000),
    'S': (0x0000, 0x0000, 0x7800, 0x7800, 0x8000, 0x8000, 0x7000, 0x7000, 0x0800, 0x0800, 0xF000, 0xF000, 0x0000, 0x0000),
    'T': (0x0000, 0x0000, 0xF800, 0xF800, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x0000, 0x0000),
    'U': (0x0000, 0x0000, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    'V': (0x0000, 0x0000, 0x8800, 0x8800, 0x9000, 0x9000, 0xA000, 0xA000, 0xC000, 0xC000, 0x8000, 0x8000, 0x0000, 0x0000),
    'W': (0x0000, 0x0000, 0x8800, 0x8800, 0x8800, 0x8800, 0xA800, 0xA800, 0xA800, 0xA800, 0x5000, 0x5000, 0x0000, 0x0000),
    'X': (0x0000, 0x0000, 0x8800, 0x8800, 0x5000, 0x5000, 0x2000, 0x2000, 0x5000, 0x5000, 0x8800, 0x8800, 0x0000, 0x0000),
    'Y': (0x0000, 0x0000, 0x8800, 0x8800, 0x5000, 0x5000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x0000, 0x0000),
    'Z': (0x0000, 0x0000, 0xF800, 0xF800, 0x1000, 0x1000, 0x2000, 0x2000, 0x4000, 0x4000, 0xF800, 0xF800, 0x0000, 0x0000),
    '[': (0x0000, 0x0000, 0xE000, 0xE000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0xE000, 0xE000, 0x0000, 0x0000),
    '\\': (0x0000, 0x0000, 0x8000, 0x8000, 0x4000, 0x4000, 0x2000, 0x2000, 0x1000, 0x1000, 0x0800, 0x0800, 0x0000, 0x0000),
    ']': (0x0000, 0x0000, 0xE000, 0xE000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0xE000, 0xE000, 0x0000, 0x0000),
    '^': (0x0000, 0x0000, 0x2000, 0x2000, 0x5000, 0x5000, 0x8800, 0x8800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000),
    '_': (0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xF800, 0xF800, 0x0000, 0x0000),
    '`': (0x0000, 0x0000, 0xC000, 0xC000, 0x8000, 0x8000, 0x4000, 0x4000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000),
    'a': (0x0000, 0x0000, 0x0000, 0x0000, 0xE000, 0xE000, 0x1000, 0x1000, 0xF000, 0xF000, 0x7000, 0x7000, 0x0000, 0x0000),
    'b': (0x0000, 0x0000, 0x8000, 0x8000, 0x8000, 0xF000, 0xF000, 0x8800, 0x8800, 0x8800, 0xF000, 0xF000, 0x0000, 0x0000),
    'c': (0x0000, 0x0000, 0x0000, 0x0000, 0x7000, 0x7000, 0x8000, 0x8000, 0x8000, 0x8000, 0x7000, 0x7000, 0x0000, 0x0000),
    'd': (0x0000, 0x0000, 0x0800, 0x0800, 0x7800, 0x7800, 0x8800, 0x8800, 0x8800, 0x8800, 0x7800, 0x7800, 0x0000, 0x0000),
    'e': (0x0000, 0x0000, 0x0000, 0x0000, 0x7000, 0x7000, 0xF800, 0xF800, 0x8000, 0x8000, 0x7800, 0x7800, 0x0000, 0x0000),
    'f': (0x0000, 0x0000, 0x3800, 0x3800, 0x4000, 0x4000, 0xE000, 0xE000, 0x4000, 0x4000, 0xE000, 0xE000, 0x0000, 0x0000),
    'g': (0x0000, 0x0000, 0x0000, 0x7800, 0x7800, 0x8800, 0x8800, 0x7800, 0x7800, 0x0800, 0x0800, 0x7000, 0x7000, 0x0000),
    'h': (0x0000, 0x0000, 0x8000, 0x8000, 0xF000, 0xF000, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x0000, 0x0000),
    'i': (0x4000, 0x4000, 0x0000, 0x0000, 0xC000, 0xC000, 0x4000, 0x4000, 0x4000, 0x4000, 0xE000, 0xE000, 0x0000, 0x0000),
    'j': (0x1000, 0x1000, 0x0000, 0x0000, 0x3000, 0x3000, 0x1000, 0x1000, 0x1000, 0x1000, 0x9000, 0x9000, 0x6000, 0x6000),
    'k': (0x0000, 0x0000, 0x9000, 0x9000, 0xA000, 0xA000, 0xC000, 0xC000, 0xA000, 0xA000, 0x9000, 0x9000, 0x0000, 0x0000),
    'l': (0x0000, 0x0000, 0xE000, 0xE000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0x2000, 0xF800, 0xF800, 0x0000, 0x0000),
    'm': (0x0000, 0x0000, 0x0000, 0x0000, 0xD000, 0xD000, 0xA800, 0xA800, 0xA800, 0x8800, 0x8800, 0x8800, 0x0000, 0x0000),
    'n': (0x0000, 0x0000, 0x0000, 0x0000, 0xB000, 0xB000, 0xC800, 0xC800, 0x8800, 0x8800, 0x8800, 0x8800, 0x0000, 0x0000),
    'o': (0x0000, 0x0000, 0x0000, 0x0000, 0x7000, 0x7000, 0x8800, 0x8800, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    'p': (0x0000, 0x0000, 0x0000, 0x0000, 0xF000, 0xF000, 0x8800, 0x8800, 0xC800, 0xC800, 0xB000, 0xB000, 0x8000, 0x8000),
    'q': (0x0000, 0x0000, 0x0000, 0x0000, 0x7800, 0x7800, 0x8800, 0x8800, 0x9800, 0x9800, 0x6800, 0x6800, 0x0800, 0x0800),
    'r': (0x0000, 0x0000, 0x0000, 0x0000, 0xD800, 0xD800, 0x6000, 0x6000, 0x4000, 0x4000, 0xE000, 0xE000, 0x0000, 0x0000),
    's': (0x0000, 0x0000, 0x0000, 0x0000, 0x7800, 0x7800, 0xC000, 0xC000, 0x3800, 0x3800, 0xF000, 0xF000, 0x0000, 0x0000),
    't': (0x0000, 0x0000, 0x4000, 0x4000, 0xE000, 0xE000, 0x4000, 0x4000, 0x4000, 0x4000, 0x3000, 0x3000, 0x0000, 0x0000),
    'u': (0x0000, 0x0000, 0x0000, 0x0000, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x8800, 0x7000, 0x7000, 0x0000, 0x0000),
    'v': (0x0000, 0x0000, 0x0000, 0x0000, 0x8800, 0x8800, 0x8800, 0x8800, 0x5000, 0x5000, 0x2000, 0x2000, 0x0000, 0x0000),
    'w': (0x0000, 0x0000, 0x0000, 0x0000, 0x8800, 0x8800, 0x8800, 0xA800, 0xA800, 0xA800, 0x5000, 0x5000, 0x0000, 0x0000),
    'x': (0x0000, 0x0000, 0x0000, 0x0000, 0x8800, 0x8800, 0x7000, 0x7000, 0x7000, 0x7000, 0x8800, 0x8800, 0x0000, 0x0000),
    'y': (0x0000, 0x0000, 0x0000, 0x0000, 0x8800, 0x8800, 0x4800, 0x4800, 0x3000, 0x3000, 0x2000, 0x2000, 0x4000, 0x4000),
    'z': (0x0000, 0x0000, 0x0000, 0x0000, 0xF800, 0xF800, 0x1000, 0x1000, 0x6000, 0x6000, 0xF800, 0xF800, 0x0000, 0x0000),
    '{': (0x0000, 0x0000, 0x6000, 0x6000, 0x4000, 0x4000, 0xC000, 0xC000, 0x4000, 0x4000, 0x6000, 0x6000, 0x0000, 0x0000),
    '|': (0x0000, 0x0000, 0x8000, 0x8000, 0x8000, 0x8000, 0x0000, 0x0000, 0x8000, 0x8000, 0x8000, 0x8000, 0x0000, 0x0000),
    '}': (0x0000, 0x0000, 0xC000, 0xC000, 0x4000, 0x4000, 0x6000, 0x6000, 0x4000, 0x4000, 0xC000, 0xC000, 0x0000, 0x0000),
    '~': (0x0000, 0x0000, 0x0000, 0x0000, 0x2000, 0x2000, 0x5000, 0x5000, 0x8800, 0x8800, 0x0000, 0x0000, 0x0000, 0x0000),
}


def get_column_bits(char: str, column: int) -> int:
    """
    Get the bitmap bits for a specific column of a character.

    Args:
        char: Character to look up (must be in font)
        column: Column number (0-15, where 0 is leftmost)

    Returns:
        Integer with bits 0-13 representing the 14 rows (bit 0 = row 13, bit 13 = row 0)
        Returns -1 if column is beyond the character width (all remaining columns are 0)

    Reference: fldigi feld.cxx get_font_data()
    """
    if column > 15 or char not in FELD_7X7_14:
        return -1

    # Get font data for this character
    rows = FELD_7X7_14[char]

    # Create mask for this column (bit 15 is leftmost)
    mask = 1 << (15 - column)

    # Build column bits (bottom to top, so row 13 is bit 0, row 0 is bit 13)
    bits = 0
    for row in range(14):
        if rows[13 - row] & mask:
            bits |= (1 << row)

    # Check if this column and all remaining columns are empty
    # (Used to determine when character transmission is complete)
    ordbits = 0
    for row_val in rows:
        ordbits |= row_val

    testval = (1 << (15 - column)) - 1
    if bits == 0 and (ordbits & testval) == 0:
        return -1

    return bits


def get_char_width(char: str) -> int:
    """
    Get the width (number of columns) of a character.

    Args:
        char: Character to measure

    Returns:
        Width in columns (1-16)
    """
    if char not in FELD_7X7_14:
        return 0

    for col in range(16):
        if get_column_bits(char, col) == -1:
            return col
    return 16
